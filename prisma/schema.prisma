// -------------------------------
// Prisma Configuration
// -------------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// -------------------------------
// MODELS
// -------------------------------

model User {
  id                String    @id @default(cuid())
  identifiant       String    @unique
  motDePasse        String
  email             String?   @unique
  nom               String?
  prenom            String?
  role              String    @default("AUTRE")
  salarieId         String?   @unique
  actif             Boolean   @default(true)
  derniereConnexion DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  salarie Salarie? @relation(fields: [salarieId], references: [id], onDelete: SetNull)

  @@map("users")
}

model Salarie {
  id            String    @id @default(cuid())
  nom           String
  prenom        String
  dateNaissance DateTime?
  email         String?   @unique
  telephone     String?
  adresse       String?
  photoUrl      String?
  poste         String
  fonction      String?
  metier        String?
  coefficient   Float?
  matricule     String?   @unique
  dateEmbauche  DateTime  @default(now())
  typeContrat   String?
  tauxHoraire   Float?
  deplacement   Float?
  niveauAcces   String?
  statut        String    @default("actif")
  perimetreId   String?
  rdcId         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  interventions            Intervention[]
  interventionsResponsable Intervention[]            @relation("InterventionResponsable")
  interventionsRDC         Intervention[]            @relation("InterventionRDC")
  affectations             AffectationPlanning[]
  affectationsIntervention AffectationIntervention[]
  user                     User?
  pointages                Pointage[]
  horaires                 Horaire[]
  salariePerimetres        SalariePerimetre[]
  affectationsPersonnel    AffectationPersonnel[]
  habilitations            Habilitation[]
  autorisations            Autorisation[]
  visitesMedicales         VisiteMedicale[]
  restrictionsMedicales    RestrictionMedicale[]
  competences              Competence[]
  conges                   Conge[]
  contactsUrgence          ContactUrgence[]
  materielFourni           MaterielFourni[]
  enginsConfies            EnginConfie[]
  materielAttribue         MaterielAttribue[]
  documentsPersonnels      DocumentPersonnel[]
  formationsSalarie        FormationSalarie[]
  accesSitesClients        AccesSiteClient[]
  affectationsVehicule     AffectationVehicule[]
  evaluations              Evaluation[]
  evenementsRH             EvenementRH[]
  vehiculesRDC             Vehicule[]                @relation("VehiculeRDC")
  codesAffaireRDC          CodeAffaire[]             @relation("CodeAffaireRDC")
  chantiersRDC             Chantier[]                @relation("ChantierRDC")

  @@map("salaries")
}

// -------------------------------
// Compétences & Habilitations
// -------------------------------

model Competence {
  id              String    @id @default(cuid())
  salarieId       String
  nom             String
  niveau          String?
  dateAcquisition DateTime?
  description     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("competences")
}

model Habilitation {
  id             String    @id @default(cuid())
  salarieId      String
  nom            String
  numero         String?
  dateObtention  DateTime
  dateExpiration DateTime?
  organisme      String?
  fichierUrl     String?
  actif          Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("habilitations")
}

model Autorisation {
  id             String    @id @default(cuid())
  salarieId      String
  nom            String
  numero         String?
  dateObtention  DateTime
  dateExpiration DateTime?
  organisme      String?
  fichierUrl     String?
  actif          Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("autorisations")
}

model VisiteMedicale {
  id            String    @id @default(cuid())
  salarieId     String
  dateVisite    DateTime
  dateProchaine DateTime?
  medecin       String?
  resultat      String?
  commentaire   String?
  fichierUrl    String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("visites_medicales")
}

model RestrictionMedicale {
  id          String    @id @default(cuid())
  salarieId   String
  type        String
  description String
  dateDebut   DateTime
  dateFin     DateTime?
  medecin     String?
  actif       Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("restrictions_medicales")
}

// -------------------------------
// Publications & Congés
// -------------------------------

model Publication {
  id               String    @id @default(cuid())
  titre            String
  contenu          String
  imageUrl         String?
  auteurId         String?
  profilsAutorises String?
  publique         Boolean   @default(false)
  perimetreId      String?
  datePublication  DateTime  @default(now())
  dateExpiration   DateTime?
  actif            Boolean   @default(true)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  perimetre Perimetre? @relation(fields: [perimetreId], references: [id], onDelete: SetNull)

  @@map("publications")
}

// -------------------------------
// Actualités
// -------------------------------

model Actualite {
  id              String    @id @default(cuid())
  titre           String
  description     String?
  contenu         String?
  imageUrl        String?
  images          String?   // JSON array of image URLs
  perimetreId     String?
  auteurId        String?
  publie          Boolean   @default(true)
  datePublication DateTime  @default(now())
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  perimetre Perimetre? @relation(fields: [perimetreId], references: [id], onDelete: SetNull)

  @@map("actualites")
}

// -------------------------------
// Messages de sécurité
// -------------------------------

model MessageSecurite {
  id          String    @id @default(cuid())
  titre       String
  contenu     String
  type        String    @default("info")
  imageUrl    String?
  perimetreId String?
  actif       Boolean   @default(true)
  dateDebut   DateTime  @default(now())
  dateFin     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  perimetre Perimetre? @relation(fields: [perimetreId], references: [id], onDelete: SetNull)

  @@map("messages_securite")
}

// -------------------------------
// Chat - Conversations
// -------------------------------

model Conversation {
  id        String    @id @default(cuid())
  nom       String?
  type      String    @default("prive")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  participants ParticipantConversation[]
  messages     Message[]

  @@map("conversations")
}

model ParticipantConversation {
  id             String   @id @default(cuid())
  conversationId String
  userId         String
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@map("participants_conversation")
}

model Message {
  id             String   @id @default(cuid())
  conversationId String
  userId         String?
  salarieId      String?
  contenu        String
  lu             Boolean  @default(false)
  createdAt      DateTime @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@map("messages")
}

model Conge {
  id                    String    @id @default(cuid())
  salarieId             String
  type                  String
  dateDebut             DateTime
  dateFin               DateTime
  dureeJours            Float?
  dureeHeures           Float?
  commentaire           String?
  statut                String    @default("en_attente")
  commentaireValidation String?
  validePar             String?
  dateValidation        DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("conges")
}

model ContactUrgence {
  id                  String   @id @default(cuid())
  salarieId           String
  nom                 String
  prenom              String
  relation            String?
  telephone           String
  telephoneSecondaire String?
  email               String?
  priorite            Int      @default(1)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("contacts_urgence")
}

// -------------------------------
// Matériel & Engins
// -------------------------------

model MaterielFourni {
  id          String   @id @default(cuid())
  salarieId   String
  type        String
  dateFourni  DateTime @default(now())
  etat        String   @default("bon")
  commentaire String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("materiel_fourni")
}

model EnginConfie {
  id                      String    @id @default(cuid())
  salarieId               String
  type                    String
  marque                  String?
  modele                  String?
  immatriculation         String
  dateAttribution         DateTime  @default(now())
  dateRestitution         DateTime?
  photoAttribution        String?
  ficheConstatAttribution String?
  photoRestitution        String?
  ficheConstatRestitution String?
  commentaire             String?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("engins_confies")
}

model MaterielAttribue {
  id              String    @id @default(cuid())
  salarieId       String
  type            String
  reference       String?
  pointure        String?
  dateAttribution DateTime  @default(now())
  dateRestitution DateTime?
  etat            String    @default("bon")
  commentaire     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("materiel_attribue")
}

model DocumentPersonnel {
  id             String    @id @default(cuid())
  salarieId      String
  type           String
  numero         String?
  dateEmission   DateTime?
  dateExpiration DateTime?
  fichierUrl     String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("documents_personnels")
}

// -------------------------------
// Formations & accès site
// -------------------------------

model FormationSalarie {
  id             String    @id @default(cuid())
  salarieId      String
  nom            String
  organisme      String?
  dateFormation  DateTime
  dateExpiration DateTime?
  duree          Float?
  fichierUrl     String?
  commentaire    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("formations_salarie")
}

model AccesSiteClient {
  id             String    @id @default(cuid())
  salarieId      String
  nomSite        String
  client         String?
  dateObtention  DateTime
  dateExpiration DateTime?
  fichierUrl     String?
  commentaire    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("acces_sites_clients")
}

// -------------------------------
// Client
// -------------------------------

model Client {
  id               String   @id @default(cuid())
  nom              String
  adresse          String?
  telephone        String?
  email            String?
  siret            String?
  siren            String?
  contactPrincipal String?
  fonction         String?
  entreprise       String?
  photoUrl         String?
  commentaire      String?
  actif            Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  chantiers     Chantier[]
  codesAffaire  CodeAffaire[]
  donneursOrdre DonneurOrdre[] @relation("ClientDonneursOrdre")

  @@map("clients")
}

// -------------------------------
// Intervention
// -------------------------------

model Intervention {
  id                    String    @id @default(cuid())
  titre                 String
  description           String?
  dateDebut             DateTime?
  dateFin               DateTime?
  dateDebutReelle       DateTime?
  dateFinReelle         DateTime?
  duree                 Float?
  dureeReelle           Float?
  tempsPrevu            Float?
  avancement            Int       @default(0)
  statut                String    @default("planifiee")
  type                  String?
  nature                String?
  secteur               String?
  usine                 String?
  latitude              Float?
  longitude             Float?
  montantTotal          Float?
  montantResteAFaire    Float?
  retexPositifs         String?
  retexNegatifs         String?
  metier                String?
  rdcId                 String?
  responsableId         String?
  codeAffaireId         String?
  donneurOrdreId        String?
  chantierId            String
  donneurOrdreNom       String?   @map("donneur_ordre_nom_old")
  donneurOrdreTelephone String?   @map("donneur_ordre_telephone_old")
  donneurOrdreEmail     String?   @map("donneur_ordre_email_old")
  salarieId             String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  chantier     Chantier      @relation(fields: [chantierId], references: [id], onDelete: Cascade)
  salarie      Salarie?      @relation(fields: [salarieId], references: [id], onDelete: SetNull)
  responsable  Salarie?      @relation("InterventionResponsable", fields: [responsableId], references: [id], onDelete: SetNull)
  rdc          Salarie?      @relation("InterventionRDC", fields: [rdcId], references: [id], onDelete: SetNull)
  codeAffaire  CodeAffaire?  @relation("InterventionCodeAffaire", fields: [codeAffaireId], references: [id], onDelete: SetNull)
  donneurOrdre DonneurOrdre? @relation("InterventionDonneurOrdre", fields: [donneurOrdreId], references: [id], onDelete: SetNull)

  materielUtilise          MaterielUtilise[]
  documentsIntervention    DocumentIntervention[]
  affectationsIntervention AffectationIntervention[]
  ressourcesIntervention   RessourceIntervention[]
  photosIntervention       PhotoIntervention[]
  autoControles            AutoControle[]
  messagesIntervention     MessageIntervention[]
  checklistSecurite        ChecklistSecurite?
  affectationsVehicule     AffectationVehicule[]

  @@map("interventions")
}

// -------------------------------
// Materiel & Ressources
// -------------------------------

model Materiel {
  id           String   @id @default(cuid())
  nom          String
  description  String?
  categorie    String
  quantite     Int      @default(1)
  unite        String   @default("unité")
  prixUnitaire Float?
  statut       String   @default("disponible")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  utilisations MaterielUtilise[]
  codeAffaire  String?

  @@map("materiels")
}

model MaterielUtilise {
  id              String    @id @default(cuid())
  quantite        Int       @default(1)
  dateDebut       DateTime
  dateFin         DateTime?
  valide          Boolean   @default(false)
  restitue        Boolean   @default(false)
  dateValidation  DateTime?
  dateRestitution DateTime?
  commentaire     String?
  interventionId  String
  materielId      String
  createdAt       DateTime  @default(now())

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)
  materiel     Materiel     @relation(fields: [materielId], references: [id], onDelete: Cascade)

  @@map("materiel_utilise")
}

model DocumentIntervention {
  id             String    @id @default(cuid())
  interventionId String
  type           String
  nom            String
  description    String?
  fichierUrl     String?
  signe          Boolean   @default(false)
  signataire     String?
  dateSignature  DateTime?
  peutEcrire     Boolean   @default(false)
  contenu        String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)

  @@map("documents_intervention")
}

model AffectationIntervention {
  id             String    @id @default(cuid())
  interventionId String
  salarieId      String
  role           String    @default("ouvrier")
  dateDebut      DateTime  @default(now())
  dateFin        DateTime?
  actif          Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)
  salarie      Salarie      @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@unique([interventionId, salarieId])
  @@map("affectations_intervention")
}

model RessourceIntervention {
  id              String    @id @default(cuid())
  interventionId  String
  type            String
  nom             String
  description     String?
  quantite        Int       @default(1)
  reference       String?
  valide          Boolean   @default(false)
  restitue        Boolean   @default(false)
  dateValidation  DateTime?
  dateRestitution DateTime?
  commentaire     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)

  @@map("ressources_intervention")
}

model PhotoIntervention {
  id             String   @id @default(cuid())
  interventionId String
  url            String
  description    String?
  auteurId       String?
  createdAt      DateTime @default(now())

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)

  @@map("photos_intervention")
}

model AutoControle {
  id               String    @id @default(cuid())
  interventionId   String
  element          String
  verifie          Boolean   @default(false)
  commentaire      String?
  verifiePar       String?
  dateVerification DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)

  @@map("auto_controles")
}

model MessageIntervention {
  id             String   @id @default(cuid())
  interventionId String
  auteurId       String
  contenu        String
  lu             Boolean  @default(false)
  createdAt      DateTime @default(now())

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)

  @@map("messages_intervention")
}

model ChecklistSecurite {
  id             String    @id @default(cuid())
  interventionId String    @unique
  elements       String
  completee      Boolean   @default(false)
  completeePar   String?
  dateCompletion DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  intervention Intervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)

  @@map("checklist_securite")
}

// -------------------------------
// Planning
// -------------------------------

model AffectationPlanning {
  id          String   @id @default(cuid())
  date        DateTime
  heureDebut  String?
  heureFin    String?
  salarieId   String
  chantierId  String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  salarie  Salarie  @relation(fields: [salarieId], references: [id], onDelete: Cascade)
  chantier Chantier @relation(fields: [chantierId], references: [id], onDelete: Cascade)

  @@map("affectations_planning")
}

// -------------------------------
// PÉRIMÈTRE
// -------------------------------

model Perimetre {
  id          String   @id @default(cuid())
  nom         String
  adresse     String
  ville       String?
  codePostal  String?
  latitude    Float?
  longitude   Float?
  description String?
  actif       Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  actualites        Actualite[]
  messagesSecurite  MessageSecurite[]
  pointages         Pointage[]
  salariePerimetres SalariePerimetre[]
  usines            Usine[]
  publications      Publication[]

  @@map("perimetres")
}

// -------------------------------
// Salaire - Périmètre (pivot)
// -------------------------------

model SalariePerimetre {
  id          String   @id @default(cuid())
  salarieId   String
  perimetreId String
  createdAt   DateTime @default(now())

  salarie   Salarie   @relation(fields: [salarieId], references: [id], onDelete: Cascade)
  perimetre Perimetre @relation(fields: [perimetreId], references: [id], onDelete: Cascade)

  @@unique([salarieId, perimetreId])
  @@map("salaries_perimetres")
}

// -------------------------------
// Chantier
// -------------------------------

model Chantier {
  id                  String   @id @default(cuid())
  nom                 String
  adresse             String?
  ville               String?
  codePostal          String?
  latitude            Float?
  longitude           Float?
  description         String?
  clientId            String?
  dateDebut           DateTime?
  dateFin             DateTime?
  budget              Float?
  statut              String   @default("planifie")
  rdcId               String?
  codeAffaireId       String?
  site                String?
  secteur             String?
  numeroCommande      String?
  donneurOrdreId      String?
  donneurOrdreNom     String?
  donneurOrdreTelephone String?
  donneurOrdreEmail   String?
  
  donneurOrdre        DonneurOrdre? @relation(fields: [donneurOrdreId], references: [id], onDelete: SetNull)
  actif               Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  client        Client?               @relation(fields: [clientId], references: [id], onDelete: SetNull)
  rdc           Salarie?              @relation("ChantierRDC", fields: [rdcId], references: [id], onDelete: SetNull)
  codeAffaire   CodeAffaire?          @relation(fields: [codeAffaireId], references: [id], onDelete: SetNull)
  interventions Intervention[]
  affectations  AffectationPlanning[]

  @@map("chantiers")
}

// -------------------------------
// Donneur d’ordre
// -------------------------------

model DonneurOrdre {
  id        String   @id @default(cuid())
  nom       String
  telephone String?
  email     String?
  clientId  String?
  actif     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  client        Client?        @relation("ClientDonneursOrdre", fields: [clientId], references: [id], onDelete: SetNull)
  chantiers     Chantier[]
  interventions Intervention[] @relation("InterventionDonneurOrdre")

  @@map("donneurs_ordre")
}

// -------------------------------
// Code Affaire
// -------------------------------

model CodeAffaire {
  id          String   @id @default(cuid())
  code        String
  description String?
  clientId    String?
  rdcId       String?
  actif       Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  client        Client?        @relation(fields: [clientId], references: [id], onDelete: SetNull)
  rdc           Salarie?       @relation("CodeAffaireRDC", fields: [rdcId], references: [id], onDelete: SetNull)
  interventions Intervention[] @relation("InterventionCodeAffaire")
  chantiers     Chantier[]

  // ⚠️ Ajouter le champ inverse pour Pointage
  pointages Pointage[]

  @@map("codes_affaire")
}

// -------------------------------
// Véhicules
// -------------------------------

model Vehicule {
  id              String   @id @default(cuid())
  type            String
  marque          String?
  modele          String?
  immatriculation String
  rdcId           String?
  actif           Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  rdc                  Salarie?              @relation("VehiculeRDC", fields: [rdcId], references: [id], onDelete: SetNull)
  affectationsVehicule AffectationVehicule[]

  @@map("vehicules")
}

// -------------------------------
// Affectation Véhicule
// -------------------------------

model AffectationVehicule {
  id             String    @id @default(cuid())
  vehiculeId     String
  salarieId      String?
  interventionId String?
  dateDebut      DateTime  @default(now())
  dateFin        DateTime?
  commentaire    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  vehicule     Vehicule      @relation(fields: [vehiculeId], references: [id], onDelete: Cascade)
  salarie      Salarie?      @relation(fields: [salarieId], references: [id], onDelete: SetNull)
  intervention Intervention? @relation(fields: [interventionId], references: [id], onDelete: SetNull)

  @@map("affectations_vehicule")
}

// -------------------------------
// Pointage
// -------------------------------

model Pointage {
  id            String   @id @default(cuid())
  salarieId     String
  perimetreId   String?
  codeAffaireId String?
  date          DateTime
  heureArrivee  String?
  heureDepart   String?
  nombreHeures  Float?
  deplacement   Float?
  primes        Float?
  type          String   @default("normal")
  commentaire   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  salarie     Salarie      @relation(fields: [salarieId], references: [id], onDelete: Cascade)
  perimetre   Perimetre?   @relation(fields: [perimetreId], references: [id], onDelete: SetNull)
  codeAffaire CodeAffaire? @relation(fields: [codeAffaireId], references: [id], onDelete: SetNull)

  @@map("pointages")
}

// -------------------------------
// Horaires
// -------------------------------

model Horaire {
  id         String   @id @default(cuid())
  salarieId  String
  date       DateTime
  heureDebut String?
  heureFin   String?
  pause      Float?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("horaires")
}

// -------------------------------
// Évaluations
// -------------------------------

model Evaluation {
  id           String   @id @default(cuid())
  salarieId    String
  type         String
  date         DateTime
  note         Float?
  commentaire  String?
  evaluateurId String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("evaluations")
}

// -------------------------------
// Événements RH
// -------------------------------

model EvenementRH {
  id          String   @id @default(cuid())
  salarieId   String
  type        String
  date        DateTime
  commentaire String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)

  @@map("evenements_rh")
}

// -------------------------------
// Affectation Personnel
// -------------------------------

model AffectationPersonnel {
  id          String    @id @default(cuid())
  salarieId   String
  structureId String
  role        String
  dateDebut   DateTime  @default(now())
  dateFin     DateTime?
  actif       Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  salarie Salarie @relation(fields: [salarieId], references: [id], onDelete: Cascade)
  // structure StructureOrganisationnelle @relation(fields: [structureId], references: [id], onDelete: Cascade)  // Commentez cette ligne

  @@map("affectations_personnel")
}

// -------------------------------
// Usine
// -------------------------------

model Usine {
  id                    String   @id @default(cuid())
  nom                   String   @unique
  secteurActivite        String?
  adresse               String
  perimetreId           String
  numeroUrgence         String?
  latitudePoste         Float?
  longitudePoste        Float?
  latitudeRassemblement Float?
  longitudeRassemblement Float?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  perimetre Perimetre @relation(fields: [perimetreId], references: [id], onDelete: Cascade)
  // structures StructureOrganisationnelle[]  // Commentez temporairement

  @@map("usines")
}
